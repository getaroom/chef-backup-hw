# Daily backup configuration generated by Chef.  Do no edit manually or changes will be overwritten.
# Backup v5.x Configuration
# ^^^  MUST NOT BE REMOVED OR `backup check --config-file /path/to/config` will completely stop working

root_path '<%= node["backup"]["base_dir"] %>'
tmp_path '.tmp'
data_path 'data'

Utilities.configure do
  <% if node["backup"]["databases"].include? "Redis" %>
  redis_cli "<%= @redis_cli_utility %>"
 <% end %>
end

Storage::S3.defaults do |s3|
  s3.access_key_id = "<%= @aws_access_key_id %>"
  s3.secret_access_key = "<%= @aws_secret_access_key %>"
  s3.bucket = "<%= @s3_bucket %>"
  s3.path = "<%= @s3_path %>"
  s3.keep = <%= @s3_keep %>
end

<% if @gpg_public_key %>
Encryptor::GPG.defaults do |encryption|
  encryption.keys = {}
  encryption.keys["operations@getaroom.com"] = open(File.join("<%= @keys_dir %>", "backups.public.gpg")).read
end
<% end %>

Database::MySQL.defaults do |db|
  db.username = "<%= @mysql_username %>"
  db.password = "<%= @mysql_password %>"
  <% if @mysql_socket %>
  db.socket = "<%= @mysql_socket %>"
  <% else %>
  db.host = "<%= @mysql_host %>"
  db.port = <%= @mysql_port %>
  <% end %>
  db.additional_options = ["--quick", "--single-transaction"]
end

Database::MongoDB.defaults  do |db|
  db.username = "<%= @mongodb_username %>"
  db.password = "<%= @mongodb_password %>"
  db.host = "<%= @mongodb_host %>"
  db.port = <%= @mongodb_port %>
  db.lock = <%= @mongodb_lock %>
  db.ipv6 = <%= @mongodb_ipv6 %>
  db.additional_options = <%= @mongodb_additional_options %>
end

Database::Redis.defaults do |db|
  db.mode = :sync
  db.rdb_path = "<%= @redis_path %>"
  db.password = "<%= @redis_password %>"
  db.host = "<%= @redis_host %>"
  db.port = <%= @redis_port %>
  db.invoke_save = <%= @redis_invoke_save %>
end
